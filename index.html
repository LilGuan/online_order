<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>é‚±åª½åª½ç¾é£Ÿ-ç·šä¸Šé»é¤</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <!-- å¼•å…¥ Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    /* CSS Reset & åŸºç¤è¨­å®š */
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body {
      font-family: 'Noto Sans TC', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f4f7f6;
      color: #333;
      padding-bottom: 80px;
    }

    /* æ¨™é¡Œå€å¡Š */
    header {
      background-color: #fff;
      padding: 1rem;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
      text-align: center;
    }
    h2 { margin: 0; color: #ff6b6b; font-size: 1.5rem; }

    /* åˆ†é¡å°è¦½åˆ— (æ–°å¢) */
    .category-tabs {
      display: flex;
      overflow-x: auto; /* å…è¨±æ©«å‘æ²å‹• */
      white-space: nowrap;
      background: #fff;
      padding: 10px 15px;
      position: sticky;
      top: 60px; /* æ ¹æ“š header é«˜åº¦èª¿æ•´ */
      z-index: 99;
      gap: 10px;
      border-bottom: 1px solid #eee;
      /* éš±è—æ²è»¸ */
      scrollbar-width: none; 
      -ms-overflow-style: none;
    }
    .category-tabs::-webkit-scrollbar { display: none; }

    .tab-btn {
      padding: 8px 16px;
      border-radius: 20px;
      border: 1px solid #ddd;
      background: #f8f9fa;
      color: #555;
      font-size: 0.95rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      flex-shrink: 0; /* é˜²æ­¢æŒ‰éˆ•è¢«å£“ç¸® */
    }

    .tab-btn.active {
      background: #ff6b6b;
      color: white;
      border-color: #ff6b6b;
      box-shadow: 0 2px 6px rgba(255, 107, 107, 0.3);
    }

    /* é¤é»åˆ—è¡¨å®¹å™¨ */
    .menu {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 12px;
      padding: 12px;
      max-width: 800px;
      margin: 0 auto;
    }

    /* å–®å€‹é¤é»å¡ç‰‡ */
    .item {
      background: white;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      display: flex;
      flex-direction: column;
      transition: transform 0.2s;
    }
    
    /* é¤é»åœ–ç‰‡å€ */
    .item-image-wrapper {
      width: 100%;
      padding-top: 75%;
      position: relative;
      background-color: #eee;
    }
    .item img {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* é¤é»å…§å®¹å€ */
    .item-content {
      padding: 10px;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
    }

    .item-name {
      font-size: 1rem;
      font-weight: 700;
      margin-bottom: 4px;
      line-height: 1.3;
      color: #2d3436;
    }

    .item-price {
      color: #ff6b6b;
      font-weight: 600;
      font-size: 1.1rem;
      margin-bottom: 8px;
    }

    /* é¸é …å€åŸŸ */
    .options-container {
      margin-bottom: 10px;
    }
    .options {
      margin-top: 5px;
      display: flex;
      align-items: center;
      font-size: 0.9rem;
      color: #636e72;
    }
    .options label {
      display: flex;
      align-items: center;
      cursor: pointer;
      width: 100%;
      background: #f8f9fa;
      padding: 6px 8px;
      border-radius: 8px;
    }
    .options input[type="checkbox"] {
      margin-right: 6px;
      width: 18px;
      height: 18px;
      accent-color: #ff6b6b;
    }

    /* æ•¸é‡æ§åˆ¶å€ */
    .controls {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: auto;
      background: #f1f3f5;
      border-radius: 20px;
      padding: 2px;
    }
    .controls button {
      width: 32px; height: 32px; border: none; background: white; border-radius: 50%;
      font-size: 1.2rem; color: #ff6b6b; display: flex; align-items: center; justify-content: center;
      cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .controls span { font-weight: 600; min-width: 24px; text-align: center; }

    /* åŠ å…¥è³¼ç‰©è»ŠæŒ‰éˆ• */
    button.add-to-cart {
      margin-top: 10px; width: 100%; background: #ff6b6b; color: white; border: none;
      padding: 10px; border-radius: 10px; font-size: 0.95rem; font-weight: 600; cursor: pointer;
      transition: background-color 0.2s;
    }
    button.add-to-cart:active { background-color: #fa5252; }

    /* è³¼ç‰©è»Šæ‡¸æµ®æŒ‰éˆ• */
    #cart-fab {
      position: fixed; bottom: 20px; right: 20px; background: #2d3436; color: white;
      width: 60px; height: 60px; border-radius: 30px; display: flex; align-items: center;
      justify-content: center; box-shadow: 0 4px 15px rgba(0,0,0,0.3); cursor: pointer;
      z-index: 1000; transition: transform 0.2s;
    }
    #cart-fab:active { transform: scale(0.95); }
    #cart-fab i { font-style: normal; font-size: 24px; }
    #cart-badge {
      position: absolute; top: -5px; right: -5px; background: #ff6b6b; color: white;
      font-size: 12px; height: 24px; min-width: 24px; padding: 0 6px; border-radius: 12px;
      display: flex; align-items: center; justify-content: center; font-weight: bold;
      border: 2px solid #f4f7f6; opacity: 0; transform: scale(0); transition: all 0.3s;
    }
    #cart-badge.show { opacity: 1; transform: scale(1); }

    /* Toast æç¤º */
    #toast {
      position: fixed; bottom: 90px; left: 50%; transform: translateX(-50%) translateY(20px);
      background: rgba(0,0,0,0.8); color: white; padding: 10px 20px; border-radius: 20px;
      font-size: 0.9rem; opacity: 0; transition: opacity 0.3s, transform 0.3s;
      pointer-events: none; z-index: 2000; white-space: nowrap;
    }
    #toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
    
    .pop-anim { animation: pop 0.3s ease; }
    @keyframes pop { 0% { transform: scale(1); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }

  </style>
</head>
<body>

<header>
  <h2>é‚±åª½åª½ç¾é£Ÿ</h2>
</header>

<!-- åˆ†é¡å°è¦½åˆ— -->
<div class="category-tabs">
  <button class="tab-btn active" onclick="filterMenu('all')">å…¨éƒ¨</button>
  <button class="tab-btn" onclick="filterMenu('rice')">é£¯é¡</button>
  <button class="tab-btn" onclick="filterMenu('noodle')">éºµé¡</button>
  <button class="tab-btn" onclick="filterMenu('alacarte')">å–®é»</button>
  <button class="tab-btn" onclick="filterMenu('soup')">æ¹¯å“</button>
</div>

<div class="menu" id="menu">
  <!-- é¤é»ç”± JS å‹•æ…‹ç”Ÿæˆ -->
</div>

<div id="cart-fab" title="å‰å¾€çµå¸³">
  <i>ğŸ›’</i>
  <div id="cart-badge">0</div>
</div>

<div id="toast">å·²åŠ å…¥è³¼ç‰©è»Š</div>

<script>
  // ç‡Ÿæ¥­æ™‚é–“æª¢æŸ¥ (ç¶­æŒä¸è®Š)
  function checkBusinessHours() {
    const now = new Date();
    const currentTime = now.getHours() * 60 + now.getMinutes();
    // 10:30 (630) - 14:00 (840), 16:00 (960) - 20:00 (1200)
    const isOpen = (currentTime >= 630 && currentTime < 840) || (currentTime >= 960 && currentTime < 1200);
    // return true; // æ¸¬è©¦ç”¨
    return isOpen;
  }

  // é¡¯ç¤ºéç‡Ÿæ¥­æ™‚é–“é®ç½©
  function showClosedModal() {
    const modalId = 'closed-modal';
    if (document.getElementById(modalId)) return; // é¿å…é‡è¤‡å»ºç«‹

    const modal = document.createElement('div');
    modal.id = modalId;
    modal.style.cssText = `
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.85); z-index: 9999;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      color: white; text-align: center; padding: 20px;
    `;
    modal.innerHTML = `
      <h2 style="margin-bottom: 10px; color: #fff;">ç›®å‰éç‡Ÿæ¥­æ™‚é–“</h2>
      <p style="font-size: 1.1rem; line-height: 1.6; margin-bottom: 20px;">
        ç‡Ÿæ¥­æ™‚é–“ï¼š<br><strong>10:30 - 14:00</strong><br><strong>16:00 - 20:00</strong>
      </p>
      <!-- æ–°å¢ï¼šå‰å¾€é è¨‚æŒ‰éˆ• -->
      <button id="preorder-btn" style="
        background: #ff6b6b; color: white; border: none; padding: 12px 30px;
        font-size: 1rem; border-radius: 25px; cursor: pointer; font-weight: bold;
        box-shadow: 0 4px 10px rgba(255, 107, 107, 0.4);
      ">å‰å¾€é è¨‚</button>
    `;
    document.body.appendChild(modal);
    document.body.style.overflow = 'hidden';

    // ç¶å®šé—œé–‰äº‹ä»¶
    document.getElementById('preorder-btn').addEventListener('click', () => {
      modal.style.display = 'none';
      document.body.style.overflow = ''; // æ¢å¾©æ²å‹•
    });
  }

  if (!checkBusinessHours()) {
    showClosedModal();
  }

  // ====== èœå–®è³‡æ–™ (å·²ç§»é™¤åŠ è¦é¸é …) ======
  // category: rice(é£¯), noodle(éºµ), alacarte(å–®é»), soup(æ¹¯)
  const menuItems = [
    { id: 1, name: 'è›‹ç‚’é£¯', price: 80, image: 'images/egg_rice.jpg', hasLarge: true, hasDoubleEgg: true, category: 'rice' },
    { id: 2, name: 'è‚‰çµ²ç‚’é£¯', price: 100, image: 'images/beef_rice.png', hasLarge: true, hasDoubleEgg: true, category: 'rice' },
    { id: 3, name: 'è‚‰çµ²ç‚’éºµ', price: 100, image: 'images/beef_noodle.jpg', hasLarge: true, hasDoubleEgg: false, category: 'noodle' },
    { id: 4, name: 'é¦™è…¸ç‚’é£¯', price: 110, image: 'images/sausage_rice.png', hasLarge: true, hasDoubleEgg: true, category: 'rice' },
    { id: 5, name: 'è¦ä»ç‚’é£¯', price: 110, image: 'images/shrimp_rice.png', hasLarge: true, hasDoubleEgg: true, hasDoubleShrimp: true, category: 'rice' },
    { id: 6, name: 'è¦ä»ç‚’éºµ', price: 110, image: 'images/shrimp_noodle.png', hasLarge: true, hasDoubleEgg: false, hasDoubleShrimp: true, category: 'noodle' },
    { id: 7, name: 'è¦ä»ç±³è‹”ç›®', price: 110, image: 'images/shrimp_rice_noodle.png', hasLarge: true, hasDoubleEgg: false, hasDoubleShrimp: true, category: 'noodle' },
    { id: 8, name: 'é¹¹è±¬è‚‰è“‹é£¯', price: 130, image: 'images/salted_pork_rice.png', hasLarge: true, hasDoubleEgg: true, category: 'rice' },
    { id: 9, name: 'é¹¹è±¬è‚‰', price: 230, image: 'images/salted_pork.png', hasLarge: false, hasDoubleEgg: false, category: 'alacarte' },
    { id: 10, name: 'æµ·å¸¶èŠ½è›‹èŠ±æ¹¯', price: 25, image: 'images/soup.png', hasLarge: false, hasDoubleEgg: false, category: 'soup' },
    { id: 11, name: 'è·åŒ…è›‹', price: 15, image: 'images/egg.png', hasLarge: false, hasDoubleEgg: false, category: 'alacarte' },
  ];

  const menuQuantities = {};
  const menuDiv = document.getElementById('menu');
  let currentCategory = 'all';

  async function initLiff() {
    try {
      await liff.init({ liffId: '2007831775-ojeB1qbw' });
      if (!liff.isLoggedIn()) liff.login();
    } catch (err) { console.error(err); }
  }

  // åˆ‡æ›åˆ†é¡
  window.filterMenu = function(category) {
    currentCategory = category;
    
    // æ›´æ–°æŒ‰éˆ•æ¨£å¼
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.classList.remove('active');
      // ç°¡å–®åˆ¤æ–·æŒ‰éˆ•æ–‡å­—æˆ–onclickåƒæ•¸ä¾†åŠ  active (é€™è£¡å·æ‡¶ç”¨ DOM é †åºæˆ–æ–‡å­—å°æ‡‰è¼ƒå¥½ï¼Œä»¥ä¸‹ç”¨æ–‡å­—åˆ¤æ–·)
      if (category === 'all' && btn.innerText === 'å…¨éƒ¨') btn.classList.add('active');
      else if (category === 'rice' && btn.innerText === 'é£¯é¡') btn.classList.add('active');
      else if (category === 'noodle' && btn.innerText === 'éºµé¡') btn.classList.add('active');
      else if (category === 'alacarte' && btn.innerText === 'å–®é»') btn.classList.add('active');
      else if (category === 'soup' && btn.innerText === 'æ¹¯å“') btn.classList.add('active');
    });

    renderMenu();
  };

  function renderMenu() {
    menuDiv.innerHTML = '';
    
    // ç¯©é¸è³‡æ–™
    const filteredItems = currentCategory === 'all' 
      ? menuItems 
      : menuItems.filter(item => item.category === currentCategory);

    filteredItems.forEach(item => {
      menuQuantities[item.id] = 1;

      const div = document.createElement('div');
      div.className = 'item';
      div.innerHTML = `
        <div class="item-image-wrapper">
          <img src="${item.image}" alt="${item.name}" loading="lazy" />
        </div>
        <div class="item-content">
          <div class="item-name">${item.name}</div>
          <div class="item-price" id="price-${item.id}">$${item.price}</div>
          
          
          <div class="options-container">
            ${item.hasLarge ? `
              <div class="options">
                <label>
                  <input type="checkbox" id="large-${item.id}" onchange="updateItemPrice(${item.id})"/>
                  <span>åŠ å¤§ (+$20)</span>
                </label>
              </div>
            ` : ''}
            
            ${item.hasDoubleEgg ? `
              <div class="options">
                <label>
                  <input type="checkbox" id="egg-${item.id}" onchange="updateItemPrice(${item.id})" />
                  <span>é›™è›‹ (+$15)</span>
                </label>
              </div>
            ` : ''}
            ${item.hasDoubleShrimp ? `
              <div class="options">
                <label>
                  <input type="checkbox" id="shrimp-${item.id}" onchange="updateItemPrice(${item.id})" />
                  <span>åŠ è¦ (+$35)</span>
                </label>
              </div>
            ` : ''}
          </div>
          
          <div style="flex-grow:1;"></div>

          <div class="controls">
            <button onclick="changeMenuQty(${item.id}, -1)">ï¼</button>
            <span id="menu-qty-${item.id}">1</span>
            <button onclick="changeMenuQty(${item.id}, 1)">ï¼‹</button>
          </div>
          
          <button class="add-to-cart" onclick="addToCart(${item.id})">åŠ å…¥è³¼ç‰©è»Š</button>
        </div>
      `;
      menuDiv.appendChild(div);
    });
  }

  // â˜…â˜…â˜… æ–°å¢ï¼šå³æ™‚æ›´æ–°å–®å“åƒ¹æ ¼ â˜…â˜…â˜…
  window.updateItemPrice = function(id) {
    const item = menuItems.find(i => i.id === id);
    if (!item) return;

    let currentPrice = item.price;

    // æª¢æŸ¥å„é¸é …æ˜¯å¦è¢«å‹¾é¸ï¼Œè‹¥æœ‰å‰‡ç´¯åŠ é‡‘é¡
    const isLarge = document.getElementById(`large-${id}`)?.checked;
    const isDoubleEgg = document.getElementById(`egg-${id}`)?.checked;
    const isDoubleShrimp = document.getElementById(`shrimp-${id}`)?.checked;

    if (isLarge) currentPrice += 20;
    if (isDoubleEgg) currentPrice += 15;
    if (isDoubleShrimp) currentPrice += 35;

    // æ›´æ–°ä»‹é¢ä¸Šçš„åƒ¹æ ¼æ–‡å­—
    const priceEl = document.getElementById(`price-${id}`);
    if (priceEl) {
      priceEl.innerText = `$${currentPrice}`;
      
      // (é¸ç”¨) å¢åŠ ä¸€é»è¦–è¦ºå›é¥‹ï¼Œè®“ä½¿ç”¨è€…çŸ¥é“åƒ¹æ ¼è®Šäº†
      priceEl.style.transition = 'color 0.2s';
      priceEl.style.color = '#2d3436'; // æš«æ™‚è®Šæ·±è‰²
      setTimeout(() => {
        priceEl.style.color = '#ff6b6b'; // è®Šå›åŸæœ¬çš„é¡è‰²
      }, 200);
    }
  };

  window.changeMenuQty = function(id, delta) {
    const current = menuQuantities[id] || 1;
    const newQty = Math.max(1, current + delta);
    menuQuantities[id] = newQty;
    const qtySpan = document.getElementById(`menu-qty-${id}`);
    if (qtySpan) {
        qtySpan.innerText = newQty;
        qtySpan.classList.remove('pop-anim');
        void qtySpan.offsetWidth;
        qtySpan.classList.add('pop-anim');
    }
  };

  window.addToCart = function(id) {
    const qty = menuQuantities[id] || 1;
    const isLarge = document.getElementById(`large-${id}`)?.checked || false;
    const isDoubleEgg = document.getElementById(`egg-${id}`)?.checked || false;
    const isDoubleShrimp = document.getElementById(`shrimp-${id}`)?.checked || false;
    // Key æ ¼å¼: ID-large-egg (å¦‚æœæ²’æœ‰å°±ä¸åŠ )
    const optionsKey = [
      isLarge ? 'large' : '',
      isDoubleEgg ? 'egg' : '',
      isDoubleShrimp ? 'shrimp' : ''
    ].filter(Boolean).join('-');

    const key = optionsKey ? `${id}-${optionsKey}` : `${id}-normal`;

    const cart = JSON.parse(localStorage.getItem('cart') || '{}');
    cart[key] = (cart[key] || 0) + qty;
    localStorage.setItem('cart', JSON.stringify(cart));

    // é‡ç½®
    menuQuantities[id] = 1;
    if (document.getElementById(`menu-qty-${id}`)) document.getElementById(`menu-qty-${id}`).innerText = '1';
    if (document.getElementById(`large-${id}`)) document.getElementById(`large-${id}`).checked = false;
    if (document.getElementById(`egg-${id}`)) document.getElementById(`egg-${id}`).checked = false;
    if (document.getElementById(`shrimp-${id}`)) document.getElementById(`shrimp-${id}`).checked = false;

    updateCartBadge();
    
    const item = menuItems.find(i => i.id === id);
    let optText = [];
    if (isLarge) optText.push('åŠ å¤§');
    if (isDoubleEgg) optText.push('é›™è›‹');
    if (isDoubleShrimp) optText.push('åŠ è¦');
    const optString = optText.length > 0 ? `(${optText.join('ã€')})` : '';

    if (document.getElementById(`shrimp-${id}`)) document.getElementById(`shrimp-${id}`).checked = false;

    // â˜…â˜…â˜… æ–°å¢ï¼šé‡ç½®å¾Œï¼Œæ›´æ–°åƒ¹æ ¼é¡¯ç¤ºå›åŸåƒ¹ â˜…â˜…â˜…
    updateItemPrice(id); 

    updateCartBadge();

    showToast(`å·²åŠ å…¥ ${qty} ä»½ ${item.name} ${optString}`);
    if (navigator.vibrate) navigator.vibrate(50);
  };

  function updateCartBadge() {
    const cart = JSON.parse(localStorage.getItem('cart') || '{}');
    const totalCount = Object.values(cart).reduce((sum, qty) => sum + qty, 0);
    const badge = document.getElementById('cart-badge');
    const fab = document.getElementById('cart-fab');
    if (totalCount > 0) {
      badge.textContent = totalCount;
      badge.classList.add('show');
      fab.classList.remove('pop-anim');
      void fab.offsetWidth;
      fab.classList.add('pop-anim');
    } else {
      badge.classList.remove('show');
    }
  }

  let toastTimeout;
  function showToast(message) {
    const toast = document.getElementById('toast');
    toast.textContent = message;
    toast.classList.add('show');
    clearTimeout(toastTimeout);
    toastTimeout = setTimeout(() => { toast.classList.remove('show'); }, 2000);
  }

  document.getElementById('cart-fab').addEventListener('click', () => {
    const cart = JSON.parse(localStorage.getItem('cart') || '{}');
    if (Object.keys(cart).length === 0) {
      showToast('è³¼ç‰©è»Šæ˜¯ç©ºçš„å–”ï¼');
      return;
    }
    window.location.href = 'cart.html';
  });

  (async function() {
    renderMenu();
    updateCartBadge();
    await initLiff();
  })();
</script>
</body>
</html>