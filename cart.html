<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>è³¼ç‰©è»Š - é‚±åª½åª½ç¾é£Ÿ</title>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f7f7f7;
    margin: 0;
    padding: 1rem;
    display: flex;
    justify-content: center;
  }

  #container {
    width: 100%;
    max-width: 600px; /* æˆ–ä½ æƒ³è¦çš„æœ€å¤§å¯¬åº¦ */
    background: white;
    padding: 1rem 1.5rem;
    border-radius: 12px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
  }
  header {
    display: flex;
    align-items: center;
    margin-bottom: 1rem;
  }
  #back-btn {
    font-size: 24px;
    cursor: pointer;
    user-select: none;
    margin-right: 1rem;
  }
  #back-btn:hover {
    color: #007bff;
  }
  h2 {
    flex-grow: 1;
    text-align: center;
    margin: 0;
  }
  #clear-cart {
    font-size: 20px;
    background: #dc3545;
    color: white;
    border: none;
    padding: 0.3rem 0.8rem;
    border-radius: 6px;
    cursor: pointer;
    user-select: none;
    transition: transform 0.3s ease;
  }
  #clear-cart:hover {
    background: #b02a37;
  }
  #clear-cart:active {
    transform: scale(0.9);
  }
  #clear-cart.bump {
    animation: bump 0.3s ease-out;
  }
  @keyframes bump {
    0% { transform: scale(1); }
    50% { transform: scale(1.3); }
    100% { transform: scale(1); }
  }

  table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
  }
  th, td {
    padding: 0.75rem;
    text-align: center;
    border-bottom: 1px solid #ddd;
  }
  th {
    background: #f0f0f0;
  }
  tbody tr:last-child td {
    border-bottom: none;
  }
  .qty-controls button {
    width: 30px; height: 30px; font-size: 18px;
    cursor: pointer;
    user-select: none;
    transition: background-color 0.3s ease;
  }
  .qty-controls button:hover {
    background-color: #eee;
  }
  .qty-controls button:active {
    background-color: #ccc;
  }
  .remove-btn {
    background: #dc3545;
    color: white;
    border: none;
    padding: 4px 8px;
    border-radius: 6px;
    cursor: pointer;
    user-select: none;
    transition: background-color 0.3s ease;
  }
  .remove-btn:hover {
    background: #b02a37;
  }
  .remove-btn:active {
    background: #7a1e23;
  }
  #notes, #payment-method {
    width: 100%;
    margin-top: 1rem;
    padding: 0.75rem;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 1rem;
    box-sizing: border-box;
  }
  #payment-method {
    margin-top: 0.5rem;
  }
  #submit-order {
    margin-top: 1.5rem;
    width: 100%;
    background: #28a745;
    color: white;
    font-size: 18px;
    padding: 1rem;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    user-select: none;
    transition: background-color 0.3s ease, transform 0.15s ease;
  }
  #submit-order:hover {
    background: #1e7e34;
  }
  #submit-order:active {
    transform: scale(0.95);
  }
  /* ç©ºè³¼ç‰©è»Šè¨Šæ¯ */
  #empty-msg {
    text-align: center;
    margin-top: 3rem;
    font-size: 1.25rem;
    color: #777;
  }
  .qty-column {
  display: flex;
  flex-direction: column;
  align-items: center;
}

</style>
</head>
<body>
<div id="container">
<header>
  <div id="back-btn" title="è¿”å›ä¸Šä¸€é ">â†</div>
  <h2>è³¼ç‰©è»Š</h2>
  <button id="clear-cart" title="æ¸…ç©ºè³¼ç‰©è»Š">æ¸…ç©ºè³¼ç‰©è»Š ğŸ—‘ï¸</button>
</header>

<div id="cart-container"></div>

<label for="name">å§“åï¼ˆå¿…å¡«ï¼‰ï¼š</label>
<input type="text" id="name" required placeholder="è«‹è¼¸å…¥å§“å" style="width:100%;padding:0.75rem;margin-bottom:1rem;border-radius:8px;border:1px solid #ccc;font-size:1rem;box-sizing:border-box;" />

<label for="phone">é›»è©±ï¼ˆå¿…å¡«ï¼‰ï¼š</label>
<input type="tel" id="phone" required placeholder="è«‹è¼¸å…¥è¯çµ¡é›»è©±" style="width:100%;padding:0.75rem;margin-bottom:1rem;border-radius:8px;border:1px solid #ccc;font-size:1rem;box-sizing:border-box;" />


<label for="notes">å‚™è¨»ï¼ˆé¸å¡«ï¼‰ï¼š</label>
<textarea id="notes" rows="3" placeholder="è«‹è¼¸å…¥è¨‚å–®å‚™è¨»..."></textarea>

<label for="payment-method">ä»˜æ¬¾æ–¹å¼ï¼š</label>
<select id="payment-method">
  <option value="cash" selected>ç¾é‡‘</option>
  <!-- ä»¥å¾Œå¯æ–°å¢æ›´å¤šä»˜æ¬¾æ–¹å¼ -->
</select>

<button id="submit-order">é€å‡ºè¨‚å–®</button>

<div id="empty-msg" style="display:none;">è³¼ç‰©è»Šæ˜¯ç©ºçš„ï¼Œè«‹å…ˆåŠ å…¥é¤é»ã€‚</div>

<!-- Bootstrap Modal (ç©ºè³¼ç‰©è»ŠéŒ¯èª¤æç¤º) -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
<div class="modal fade" id="emptyCartModal" tabindex="-1" aria-labelledby="emptyCartModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-center">
      <div class="modal-header">
        <h5 class="modal-title w-100" id="emptyCartModalLabel">éŒ¯èª¤</h5>
      </div>
      <div class="modal-body">
        è³¼ç‰©è»Šæ˜¯ç©ºçš„ï¼Œè«‹å…ˆåŠ å…¥é¤é»ï¼
      </div>
      <div class="modal-footer justify-content-center">
        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">ç¢ºå®š</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="formErrorModal" tabindex="-1" aria-labelledby="formErrorModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-center">
      <div class="modal-header">
        <h5 class="modal-title w-100" id="formErrorModalLabel">è¼¸å…¥éŒ¯èª¤</h5>
      </div>
      <div class="modal-body" id="formErrorMsg">
        <!-- éŒ¯èª¤è¨Šæ¯æœƒé€é JS å‹•æ…‹å¡«å…¥ -->
      </div>
      <div class="modal-footer justify-content-center">
        <button type="button" class="btn btn-warning" data-bs-dismiss="modal">ç¢ºå®š</button>
      </div>
    </div>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>

  const LIFF_ID = "2007831775-ojeB1qbw";

  // ====== Flex ç›¸é—œå¸¸æ•¸ï¼ˆç…§ä½ çš„éœ€æ±‚å·²è¨­å®šï¼‰======
  const ORDER_DETAIL_URL = "https://liff.line.me/2007831775-ojeB1qbw/order-detail.html";
  const STORE_PHONE      = "tel:033812828";
  const BRAND_NAME       = "é‚±åª½åª½ç¾é£Ÿ";
  // TODO: å°‡ä¸‹è¡Œæ›æˆä½ ã€Œå…¬é–‹ HTTPSã€çš„ logo é€£çµï¼ˆç›®å‰ç‚ºæš«æ™‚å¯ç”¨çš„ placeholderï¼‰
  const BRAND_LOGO_URL   = "https://raw.githubusercontent.com/LilGuan/online_order/main/images/logo.jpg";
  const STORE_ADDRESS    = "æ¡ƒåœ’å¸‚å¤§åœ’å€çš‡å®¶å…­è¡—12è™Ÿ";
  const MAPS_URL         = "https://www.google.com/maps/search/?api=1&query=" + encodeURIComponent(STORE_ADDRESS);
  // Hero åœ–ï¼ˆå¯æ›æˆä½ è‡ªå®¶çš„å¯¦æ‹ï¼‰
  const HERO_IMAGE_URL   = "https://images.unsplash.com/photo-1604908554007-0880a8a94571?q=80&w=1600&auto=format&fit=crop";

  const cartContainer = document.getElementById('cart-container');
  const clearCartBtn = document.getElementById('clear-cart');
  const backBtn = document.getElementById('back-btn');
  const submitOrderBtn = document.getElementById('submit-order');
  const notesInput = document.getElementById('notes');
  const paymentSelect = document.getElementById('payment-method');
  const emptyMsg = document.getElementById('empty-msg');
  const emptyCartModal = new bootstrap.Modal(document.getElementById('emptyCartModal'));
  const formErrorModal = new bootstrap.Modal(document.getElementById('formErrorModal'));
  const formErrorMsg = document.getElementById('formErrorMsg');

  const menuItems = [
    { id: 1, name: 'è¦ä»ç‚’é£¯', price: 100 },
    { id: 2, name: 'è‚‰çµ²ç‚’é£¯', price: 85 },
    { id: 3, name: 'é¦™è…¸ç‚’é£¯', price: 100 },
    { id: 4, name: 'è›‹ç‚’é£¯', price: 75 },
    { id: 5, name: 'è¦ä»ç‚’éºµ', price: 100 },
    { id: 6, name: 'è¦ä»ç±³è‹”ç›®', price: 100 },
    { id: 7, name: 'é¹¹è±¬è‚‰è“‹é£¯', price: 120 },
    { id: 8, name: 'é¹¹è±¬è‚‰', price: 200 },
    { id: 9, name: 'æµ·å¸¶èŠ½è›‹èŠ±æ¹¯', price: 20 },
    { id: 10, name: 'è·åŒ…è›‹', price: 15 },
  ];

  function loadCart() {
    return JSON.parse(localStorage.getItem('cart') || '{}');
  }

  function saveCart(cart) {
    localStorage.setItem('cart', JSON.stringify(cart));
  }

  function getNameById(id) {
    const item = menuItems.find(i => i.id === parseInt(id));
    return item ? item.name : 'æœªçŸ¥é¤é»';
  }

  function getPriceById(id) {
    const item = menuItems.find(i => i.id === parseInt(id));
    return item ? item.price : 0;
  }

  function renderCart() {
    const cart = loadCart();
    const keys = Object.keys(cart);
    if (keys.length === 0) {
      cartContainer.innerHTML = '';
      emptyMsg.style.display = 'block';
      return;
    }
    emptyMsg.style.display = 'none';

    let html = `<table>
      <thead>
        <tr>
          <th>é¤é»åç¨±</th>
          <th>å–®åƒ¹</th>
          <th>æ•¸é‡</th>
          <th>å°è¨ˆ</th>
          <th>æ“ä½œ</th>
        </tr>
      </thead>
      <tbody>`;

    let total = 0;

    keys.forEach(key => {
      const qty = cart[key];
      const [idStr, size] = key.split('-');
      const id = parseInt(idStr);
      const isLarge = size === 'large';

      const item = menuItems.find(i => i.id === id);
      if (!item) return;

      const name = item.name + (isLarge ? 'ï¼ˆåŠ å¤§ï¼‰' : '');
      const price = item.price + (isLarge ? 20 : 0);
      const subtotal = price * qty;
      total += subtotal;

      html += `
        <tr data-key="${key}">
          <td>${name}</td>
          <td>$${price}</td>
          <td class="qty-controls">
            <div class="qty-column">
              <button onclick="changeQty('${key}', 1)">+</button>
              <span id="qty-${key}">${qty}</span>
              <button onclick="changeQty('${key}', -1)">ï¼</button>
            </div>
          </td>

          <td>$${subtotal}</td>
          <td><button class="remove-btn" onclick="removeItem('${key}')">åˆªé™¤</button></td>
        </tr>`;
    });

    html += `</tbody></table>
      <h3 style="text-align:right;margin-top:1rem;">ç¸½é‡‘é¡ï¼š$${total}</h3>`;

    cartContainer.innerHTML = html;
  }

  function updateTotal() {
    const cart = loadCart();
    let total = 0;
    for (const key in cart) {
      const qty = cart[key];
      const [idStr, size] = key.split('-');
      const id = parseInt(idStr);
      const isLarge = size === 'large';
      const price = getPriceById(id) + (isLarge ? 20 : 0);
      total += price * qty;
    }
    const totalH3 = document.querySelector('h3');
    if (totalH3) {
      totalH3.textContent = `ç¸½é‡‘é¡ï¼š$${total}`;
    }
  }

  function changeQty(key, delta) {
    const cart = loadCart();
    const current = cart[key] || 1;
    const newQty = Math.max(1, current + delta);
    cart[key] = newQty;
    saveCart(cart);

    document.getElementById(`qty-${key}`).innerText = newQty;

    // æ›´æ–°å°è¨ˆ
    const [idStr, size] = key.split('-');
    const id = parseInt(idStr);
    const isLarge = size === 'large';
    const price = getPriceById(id) + (isLarge ? 20 : 0);
    const row = document.querySelector(`tr[data-key="${key}"]`);
    if (row) {
      const subtotalCell = row.querySelector("td:nth-child(4)");
      subtotalCell.textContent = `$${price * newQty}`;
    }

    updateTotal();
  }

  function removeItem(key) {
    const cart = loadCart();
    delete cart[key];
    saveCart(cart);
    renderCart();
  }

  function clearCart() {
    localStorage.removeItem('cart');
    renderCart();
  }

  function animateButton(btn) {
    btn.classList.add('bump');
    setTimeout(() => btn.classList.remove('bump'), 300);
  }

  clearCartBtn.addEventListener('click', () => {
    animateButton(clearCartBtn);
    clearCart();
  });

  backBtn.addEventListener('click', () => {
    window.location.href = 'index.html';
  });

  // Flex Message ç”¢ç”Ÿå‡½å¼
  function createOrderFlexMessage(orderData, menuItems) {
  const cart = orderData.cart;
  const items = [];
  let total = 0;

  // å…¨éƒ¨å“é …åˆ—å‡º
  for (const key in cart) {
    const qty = cart[key];
    const [idStr, size] = key.split('-');
    const id = parseInt(idStr);
    const isLarge = size === 'large';
    const item = menuItems.find(i => i.id === id);
    if (!item) continue;

    const name = item.name + (isLarge ? 'ï¼ˆåŠ å¤§ï¼‰' : '');
    const price = item.price + (isLarge ? 20 : 0);
    const subtotal = price * qty;
    total += subtotal;

    items.push({
      type: "box",
      layout: "horizontal",
      contents: [
        { type: "text", text: name, size: "sm", color: "#333333", flex: 5, wrap: true },
        { type: "text", text: `x${qty}`, size: "sm", color: "#666666", flex: 2, align: "center" },
        { type: "text", text: `$${subtotal}`, size: "sm", color: "#111111", flex: 3, align: "end" }
      ]
    });
  }

  const paymentText = orderData.paymentMethod === "cash" ? "ç¾é‡‘" : orderData.paymentMethod;
  const pickupSingleLine = `â° ${orderData.pickupTime}`; // ä¸æ›è¡Œ

  const notesBox = orderData.notes
    ? {
        type: "box",
        layout: "vertical",
        backgroundColor: "#FFF8E1",
        cornerRadius: "8px",
        paddingAll: "10px",
        contents: [
          { type: "text", text: "å‚™è¨»", weight: "bold", size: "sm", color: "#946200" },
          { type: "text", text: orderData.notes, size: "sm", color: "#946200", wrap: true, margin: "xs" }
        ],
        margin: "md"
      }
    : null;

  return {
    type: "flex",
    altText: `æ–°è¨‚å–® ${orderData.orderNumber} å·²æˆç«‹`,
    contents: {
      type: "bubble",

      hero: {
        type: "image",
        url: HERO_IMAGE_URL,
        size: "full",
        aspectRatio: "20:9",
        aspectMode: "cover"
      },

      // æŠŠå¾½ç« å¡åˆ° headerï¼Œè²¼ç·Šé›»è©±ä¸‹æ–¹ï¼Œæ¸›å°‘ç•™ç™½
      header: {
        type: "box",
        layout: "vertical",
        paddingAll: "12px",
        backgroundColor: "#F6F8FF",
        spacing: "sm",
        contents: [
          {
            type: "box",
            layout: "horizontal",
            spacing: "12px",
            contents: [
              { type: "image", url: BRAND_LOGO_URL, size: "sm", aspectMode: "cover", aspectRatio: "1:1" },
              {
                type: "box",
                layout: "vertical",
                contents: [
                  { type: "text", text: BRAND_NAME, weight: "bold", size: "md", color: "#1F1F1F" },
                  { type: "text", text: `#${orderData.orderNumber}`, size: "xs", color: "#8C8C8C" }
                ]
              }
            ]
          },
          {
            type: "box",
            layout: "vertical",
            margin: "sm",          // å£“åˆ°æœ€å°
            contents: [
              { type: "text", text: `å§“åï¼š${orderData.name}`, size: "sm", color: "#595959" },
              { type: "text", text: `é›»è©±ï¼š${orderData.phone}`, size: "sm", color: "#595959", margin: "xs" }
            ]
          },
          // å¾½ç« åˆ—ï¼ˆç·Šè²¼é›»è©±ä¸‹æ–¹ï¼‰
          {
            type: "box",
            layout: "horizontal",
            spacing: "sm",
            margin: "sm",
            contents: [
              {
                type: "box",
                layout: "vertical",
                backgroundColor: "#E6FFFB",
                cornerRadius: "12px",
                paddingAll: "8px",
                contents: [
                  { type: "text", text: pickupSingleLine, size: "sm", color: "#08979C", wrap: false }
                ],
                flex: 7
              },
              {
                type: "box",
                layout: "vertical",
                backgroundColor: "#FFF1F0",
                cornerRadius: "12px",
                paddingAll: "8px",
                contents: [
                  { type: "text", text: `ğŸ’³ ${paymentText}`, size: "sm", color: "#D4380D", wrap: false }
                ],
                flex: 5
              }
            ]
          }
        ]
      },

      body: {
        type: "box",
        layout: "vertical",
        spacing: "none", // ç¸®å°æ•´é«”é–“è·
        contents: [
          {
            type: "box",
            layout: "horizontal",
            backgroundColor: "#FAFAFA",
            cornerRadius: "10px",
            paddingAll: "10px",
             margin: "none", // ä¸ç•™ç™½
            contents: [
              { type: "text", text: "ğŸ“", size: "md", flex: 1 },
              { type: "text", text: STORE_ADDRESS, size: "sm", color: "#434343", wrap: true, flex: 11 }
            ]
          },

          { type: "separator", margin: "md" },

          { type: "text", text: "å“é …", weight: "bold", size: "sm", color: "#262626" },
          ...items,

          {
            type: "box",
            layout: "horizontal",
            backgroundColor: "#F0F5FF",
            cornerRadius: "10px",
            paddingAll: "12px",
            margin: "md",
            contents: [
              { type: "text", text: "ç¸½é‡‘é¡", weight: "bold", flex: 5, color: "#1D39C4" },
              { type: "text", text: `$${total}`, weight: "bold", flex: 7, align: "end", color: "#1D39C4" }
            ]
          },

          ...(notesBox ? [notesBox] : [])
        ]
      },

      // è‡ªè¨‚åº•éƒ¨ä¸‰éµï¼Œä¿è­‰å››å€‹å­—å®Œæ•´é¡¯ç¤ºï¼ˆç”¨ box + actionï¼Œæ–‡å­— size: xsã€wrap:falseï¼‰
      footer: {
        type: "box",
        layout: "horizontal",
        spacing: "sm",
        contents: [
          {
            type: "box",
            layout: "vertical",
            flex: 4,
            backgroundColor: "#2F54EB",
            cornerRadius: "8px",
            paddingAll: "10px",
            action: { type: "uri", uri: ORDER_DETAIL_URL },
            contents: [
              { type: "text", text: "æŸ¥çœ‹è¨‚å–®", size: "xs", weight: "bold", align: "center", color: "#FFFFFF", wrap: false }
            ]
          },
          {
            type: "box",
            layout: "vertical",
            flex: 4,
            backgroundColor: "#595959",
            cornerRadius: "8px",
            paddingAll: "10px",
            action: { type: "uri", uri: STORE_PHONE },
            contents: [
              { type: "text", text: "è¯çµ¡åº—å®¶", size: "xs", weight: "bold", align: "center", color: "#FFFFFF", wrap: false }
            ]
          },
          {
            type: "box",
            layout: "vertical",
            flex: 4,
            backgroundColor: "#1890FF",
            cornerRadius: "8px",
            paddingAll: "10px",
            action: { type: "uri", uri: MAPS_URL },
            contents: [
              { type: "text", text: "åœ°åœ–å°èˆª", size: "xs", weight: "bold", align: "center", color: "#FFFFFF", wrap: false }
            ]
          }
        ]
      },
      styles: { body: { separator: false }, footer: { separator: true } }
    }
  };
}




  submitOrderBtn.addEventListener('click', () => {
    const cart = loadCart();
    const nameInput = document.getElementById('name');
    const phoneInput = document.getElementById('phone');
    let name = nameInput.value.trim();
    const phone = phoneInput.value.trim();
    const taiwanPhoneRegex = /^09\d{8}$|^0\d{1,2}-?\d{6,8}$/;

    if (Object.keys(cart).length === 0) {
      emptyCartModal.show();
      return;
    }

    if (!name) {
      formErrorMsg.innerText = 'è«‹è¼¸å…¥å§“å';
      formErrorModal.show();
      return;
    }

    if (!phone) {
      formErrorMsg.innerText = 'è«‹è¼¸å…¥é›»è©±';
      formErrorModal.show();
      return;
    }

    if (!taiwanPhoneRegex.test(phone)) {
      formErrorMsg.innerText = 'é›»è©±æ ¼å¼éŒ¯èª¤ï¼Œè«‹è¼¸å…¥æ­£ç¢ºçš„å°ç£é›»è©±è™Ÿç¢¼ï¼ˆä¾‹ï¼š0912345678 æˆ– 02-12345678ï¼‰';
      formErrorModal.show();
      return;
    }

    // è‹¥å§“åé•·åº¦è¶…é5å­—ï¼ŒåŠ ä¸Šã€Œå…ˆç”Ÿã€æˆ–ã€Œå°å§ã€çš„åˆ¤æ–·
    if (name.length <= 5) {
      name = name + ' å…ˆç”Ÿ/å°å§';
    }

      function generateOrderNumber() {
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
        let result = '';
        for (let i = 0; i < 6; i++) {
          result += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        return result;
      }
    // è‡ªå‹•ç”¢ç”Ÿè¨‚å–®ç·¨è™Ÿ (æ ¼å¼: T + æ™‚é–“æˆ³)
    const orderNumber = generateOrderNumber();

    // å–é¤æ™‚é–“ç¤ºæ„ï¼ˆå¯æ”¹æˆä½¿ç”¨è€…è¼¸å…¥ï¼‰
    const pickupTime = (() => {
      const now = new Date();
      now.setMinutes(now.getMinutes() + 15);
      const hh = now.getHours().toString().padStart(2, '0');
      const mm = now.getMinutes().toString().padStart(2, '0');
      return `ç´„ ${hh}:${mm} å–é¤`;
    })();

    // å‚™è¨»èˆ‡ä»˜æ¬¾æ–¹å¼
    const notes = notesInput.value.trim();
    const paymentMethod = paymentSelect.value;

    // çµ„åˆè¨‚å–®è³‡æ–™
    const orderData = {
      name,
      phone,
      cart,
      notes,
      paymentMethod,
      orderNumber,
      pickupTime
    };

    localStorage.setItem('orderData', JSON.stringify(orderData));

    const flexMessage = createOrderFlexMessage(orderData, menuItems);

    liff.init({ liffId: LIFF_ID }).then(() => {
      if (!liff.isLoggedIn()) {
        liff.login();
        return;
      }
      return liff.sendMessages([flexMessage]);
    }).then(() => {
      // alert('è¨‚å–®å·²é€å‡ºï¼Œæ„Ÿè¬æ‚¨çš„è¨‚è³¼ï¼');
      window.location.href = 'order-detail.html';
    }).catch(err => {
      alert('LINE è¨Šæ¯å‚³é€å¤±æ•—ï¼Œè«‹ç¢ºèªæ˜¯å¦ç”±æ‰‹æ©ŸLine App é€²å…¥ä¸‹å–®ã€‚');
      console.error(err);

      if (confirm('æ˜¯å¦è¦é–‹å•Ÿ LINE App é€²å…¥å®˜æ–¹å¸³è™Ÿä¸‹å–®ï¼Ÿ')) {
        // æ›æˆä½ çš„å®˜æ–¹å¸³è™Ÿç¶²å€æˆ– LIFF ç¶²é ç¶²å€
        window.location.href = 'https://line.me/R/ti/p/@799wtujm';
        // æˆ–è€…ç›´æ¥è·³ LIFF é é¢ç¶²å€ä¹Ÿå¯ä»¥
        // window.location.href = 'https://liff.line.me/2007831775-ojeB1qbw';
      }
    });
  });

  // é é¢è¼‰å…¥æ™‚æ¸²æŸ“è³¼ç‰©è»Š
  renderCart();

  // è®“ changeQty, removeItem å¯ç”¨æ–¼ onclick å±¬æ€§
  window.changeQty = changeQty;
  window.removeItem = removeItem;

</script>
</div>
</body>
</html>
